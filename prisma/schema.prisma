// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 1. USERS TABLE
model User {
  id           Int       @id @default(autoincrement()) @map("user_id")
  email        String    @unique
  passwordHash String    @map("password_hash")
  fullName     String    @map("full_name")
  role         String    @default("customer") // 'customer' or 'admin'
  
  addresses    Address[]
  orders       Order[]

  @@map("users")
}

// 2. ADDRESSES TABLE
model Address {
  id            Int    @id @default(autoincrement()) @map("address_id")
  userId        Int    @map("user_id")
  label         String // e.g., "Home", "Office"
  streetAddress String @map("street_address")
  city          String
  postalCode    String @map("postal_code")
  country       String

  user          User   @relation(fields: [userId], references: [id])

  @@map("addresses")
}

// 3. CATEGORIES TABLE
model Category {
  id               Int    @id @default(autoincrement()) @map("category_id")
  name             String
  parentCategoryId Int?   @map("parent_category_id")

  parent           Category?  @relation("CategoryHierarchy", fields: [parentCategoryId], references: [id])
  children         Category[] @relation("CategoryHierarchy")
  products         Product[]

  @@map("categories")
}

// 4. PRODUCTS TABLE
model Product {
  id          Int      @id @default(autoincrement()) @map("product_id")
  categoryId  Int      @map("category_id")
  name        String
  description String
  basePrice   Decimal  @map("base_price")

  images      String[] @map("images") 

  category    Category         @relation(fields: [categoryId], references: [id])
  variants    ProductVariant[]

  @@map("products")
}

// 5. PRODUCT_VARIANTS TABLE
model ProductVariant {
  id            Int    @id @default(autoincrement()) @map("variant_id")
  productId     Int    @map("product_id")
  color         String
  size          String
  stockQuantity Int    @map("stock_quantity")

  // Relationships
  product       Product     @relation(fields: [productId], references: [id])
  orderItems    OrderItem[]

  @@map("product_variants")
}

// 6. ORDERS TABLE
model Order {
  id          Int      @id @default(autoincrement()) @map("order_id")
  userId      Int      @map("user_id")
  totalAmount Decimal  @map("total_amount")
  status      String   // 'Pending', 'Shipped', 'Delivered'
  createdAt   DateTime @default(now()) @map("created_at")

  // Relationships
  user        User        @relation(fields: [userId], references: [id])
  items       OrderItem[]

  @@map("orders")
}

// 7. ORDER_ITEMS TABLE
model OrderItem {
  id              Int     @id @default(autoincrement()) @map("order_item_id")
  orderId         Int     @map("order_id")
  variantId       Int     @map("variant_id")
  quantity        Int
  priceAtPurchase Decimal @map("price_at_purchase")

  // Relationships
  order           Order          @relation(fields: [orderId], references: [id])
  variant         ProductVariant @relation(fields: [variantId], references: [id])

  @@map("order_items")
}